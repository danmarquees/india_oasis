{% load static %}
<!doctype html>
<html lang="pt-BR">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>{% block title %}India Oasis{% endblock title %}</title>

        <!-- Tailwind CSS (via Play CDN for rapid development) -->
        <script src="https://cdn.tailwindcss.com"></script>

        <!-- Font Awesome -->
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        />

        <!-- Google Fonts: Teko, Rajdhani, Montserrat -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Teko:wght@400;700&family=Rajdhani:wght@400;700&family=Montserrat:wght@400;700&display=swap"
            rel="stylesheet"
        />

        <!-- Custom CSS -->
        <link rel="stylesheet" href="{% static 'css/styles.css' %}" />

        <style>
            /* Custom styles for toast notifications */
            #toast-container {
                position: fixed;
                top: 1.5rem;
                right: 1.5rem;
                z-index: 9999;
                display: flex;
                flex-direction: column;
                gap: 0.75rem;
            }
            .toast {
                display: flex;
                align-items: center;
                padding: 1rem;
                border-radius: 0.5rem;
                box-shadow:
                    0 4px 6px -1px rgb(0 0 0 / 0.1),
                    0 2px 4px -2px rgb(0 0 0 / 0.1);
                opacity: 0;
                transform: translateX(100%);
                transition: all 0.4s cubic-bezier(0.215, 0.61, 0.355, 1);
            }
            .toast.show {
                opacity: 1;
                transform: translateX(0);
            }
            .toast.success {
                background-color: #f0fdf4; /* green-50 */
                color: #166534; /* green-800 */
            }
            .toast.error {
                background-color: #fef2f2; /* red-50 */
                color: #991b1b; /* red-800 */
            }
            .toast-icon {
                margin-right: 0.75rem;
                font-size: 1.25rem;
            }
        </style>

        {% block custom_css %}{% endblock custom_css %}

        <script>
            tailwind.config = {
                theme: {
                    extend: {
                        colors: {
                            primary: "#D97706", // Amber-600
                            secondary: "#6B7280", // Gray-500
                            accent: "#FBBF24", // Amber-400
                            "cinnamon-brown": "#8B4513",
                        },
                        fontFamily: {
                            teko: ["Teko", "sans-serif"],
                            rajdhani: ["Rajdhani", "sans-serif"],
                            sans: ["Montserrat", "sans-serif"],
                        },
                    },
                },
            };
        </script>
    </head>
    <body class="bg-gray-50 font-sans">
        <!-- Toast Notification Container -->
        <div id="toast-container"></div>

        <!-- Menu Lateral Retrátil -->
        <div
            id="menu-overlay"
            class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 transition-opacity duration-300"
        ></div>
        <aside
            id="side-menu"
            class="fixed top-0 left-0 w-72 h-full bg-white shadow-lg transform -translate-x-full transition-transform duration-300 ease-in-out z-50 overflow-y-auto"
        >
            <div class="p-4">
                <button
                    id="close-menu-btn"
                    class="absolute top-4 right-4 text-2xl text-gray-500 hover:text-primary"
                >
                    &times;
                </button>
                <h2 class="text-3xl font-teko text-primary mb-6">Menu</h2>
                <h3 class="font-teko text-2xl text-secondary mb-4">
                    <i class="fas fa-tags mr-2 text-primary"></i>
                    Categorias
                </h3>
                <ul class="space-y-2">
                    <li>
                        <a
                            href="{% url 'store:product_list' %}"
                            class="category-link flex items-center p-3 rounded-lg hover:bg-yellow-50 hover:text-primary transition-all duration-200 hover:shadow-md"
                        >
                            <i
                                class="fas fa-th-large mr-3 text-primary w-5"
                            ></i>
                            <span>Todos os Produtos</span>
                        </a>
                    </li>
                    {% for category in categories %}
                    <li>
                        <a
                            href="{% url 'store:product_list_by_category' category.slug %}"
                            class="category-link flex items-center p-3 rounded-lg hover:bg-yellow-50 hover:text-primary transition-all duration-200 hover:shadow-md"
                        >
                            <i class="fas fa-tag mr-3 text-primary w-5"></i>
                            <span>{{ category.name }}</span>
                        </a>
                    </li>
                    {% endfor %}
                </ul>
                <div class="mt-8 pt-6 border-t border-gray-200">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="font-teko text-xl text-secondary">
                            <i class="fas fa-star mr-2 text-accent"></i>
                            Acesso Rápido
                        </h3>
                    </div>
                    <ul class="space-y-2">
                        <li>
                            <a
                                href="{% url 'store:wishlist' %}"
                                class="flex items-center p-2 rounded-lg hover:bg-yellow-50 hover:text-primary transition-colors"
                            >
                                <i
                                    class="fas fa-heart mr-3 text-red-500 w-5"
                                ></i>
                                <span>Meus Favoritos</span>
                                <span
                                    class="ml-auto bg-gray-200 text-gray-700 text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold"
                                    id="wishlist-mini-count"
                                    >{{ wishlist_count }}</span
                                >
                            </a>
                        </li>
                        <li>
                            <a
                                href="{% url 'store:cart' %}"
                                class="flex items-center p-2 rounded-lg hover:bg-yellow-50 hover:text-primary transition-colors"
                            >
                                <i
                                    class="fas fa-shopping-cart mr-3 text-blue-500 w-5"
                                ></i>
                                <span>Meu Carrinho</span>
                                <span
                                    class="ml-auto bg-gray-200 text-gray-700 text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold"
                                    id="cart-mini-count"
                                    >{{ cart_count }}</span
                                >
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </aside>

        <!-- Cabeçalho -->
        <header class="bg-white shadow-md sticky top-0 z-40">
            <nav
                class="container mx-auto px-4 sm:px-6 lg:px-8 py-3 flex justify-between items-center"
            >
                <div class="flex items-center space-x-4">
                    <button
                        id="open-menu-btn"
                        class="text-xl hover:text-primary"
                        title="Abrir menu"
                    >
                        <i class="fas fa-bars"></i>
                    </button>
                    <a href="{% url 'store:home' %}" class="flex items-center">
                        <img
                            src="{% static 'images/logo.png' %}"
                            alt="India Oasis Logo"
                            class="h-14"
                        />
                    </a>
                </div>
                <div class="hidden md:flex items-center space-x-6">
                    <a
                        href="{% url 'store:home' %}"
                        class="text-lg text-gray-700 hover:text-primary font-semibold"
                        >Início</a
                    >
                    <a
                        href="{% url 'store:product_list' %}"
                        class="text-lg text-gray-700 hover:text-primary"
                        >Produtos</a
                    >
                    <a
                        href="{% url 'store:contact' %}"
                        class="text-lg text-gray-700 hover:text-primary"
                        >Contato</a
                    >
                    <a
                        href="{% url 'store:about' %}"
                        class="text-lg text-gray-700 hover:text-primary"
                        >Sobre Nós</a
                    >
                </div>
                <div class="flex items-center space-x-4">
                    <a
                        href="{% url 'store:wishlist' %}"
                        class="relative text-xl hover:text-primary"
                        title="Meus Favoritos"
                    >
                        <i class="fas fa-heart"></i>
                        {% if wishlist_count > 0 %}
                        <span
                            id="wishlist-count"
                            class="absolute -top-2 -right-2 bg-accent text-black text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold"
                            >{{ wishlist_count }}</span
                        >
                        {% endif %}
                    </a>
                    <a
                        href="{% url 'store:cart' %}"
                        class="relative text-xl hover:text-primary"
                        title="Meu Carrinho"
                    >
                        <i class="fas fa-shopping-cart"></i>
                        <span
                            id="cart-count"
                            class="absolute -top-2 -right-2 bg-accent text-black text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold {% if cart_count == 0 %}hidden{% endif %}"
                            >{{ cart_count }}</span
                        >
                    </a>
                    <div
                        class="w-px h-6 bg-gray-200 mx-2 hidden sm:block"
                    ></div>
                    {% if user.is_authenticated %}
                    <div class="hidden sm:flex items-center space-x-4">
                        <a
                            href="{% url 'store:profile' %}"
                            class="font-semibold hover:text-primary"
                            >Olá,
                            {{user.first_name|default:user.username|truncatechars:15}}</a
                        >
                        <a
                            href="{% url 'store:logout' %}"
                            class="btn bg-gray-200 hover:bg-gray-300 text-gray-800 text-sm px-4 py-2 rounded-lg"
                            >Sair</a
                        >
                    </div>
                    <a
                        href="{% url 'store:profile' %}"
                        class="sm:hidden text-xl hover:text-primary"
                        ><i class="fas fa-user-circle"></i
                    ></a>
                    {% else %}
                    <a
                        href="{% url 'store:login' %}"
                        class="btn bg-gray-100 hover:bg-gray-200 text-gray-800 text-sm px-4 py-2 rounded-lg hidden sm:flex"
                        >Login</a
                    >
                    <a
                        href="{% url 'store:signup' %}"
                        class="btn bg-primary hover:bg-amber-700 text-white text-sm px-4 py-2 rounded-lg hidden sm:flex"
                        >Cadastro</a
                    >
                    <a
                        href="{% url 'store:login' %}"
                        class="sm:hidden text-xl hover:text-primary"
                        ><i class="fas fa-user-circle"></i
                    ></a>
                    {% endif %}
                </div>
            </nav>
        </header>

        <!-- Conteúdo Principal -->
        <main>
            {% if messages %}
            <div class="container mx-auto px-4 mt-4">
                {% for message in messages %}
                <div
                    class="p-4 mb-4 text-sm rounded-lg {% if message.tags == 'success' %} bg-green-100 text-green-800 {% elif message.tags == 'error' %} bg-red-100 text-red-800 {% else %} bg-blue-100 text-blue-800 {% endif %}"
                    role="alert"
                >
                    {{ message }}
                </div>
                {% endfor %}
            </div>
            {% endif %} {% block content %}{% endblock content %}
        </main>

        <!-- Rodapé -->
        <footer class="bg-white border-t mt-12">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                    <div>
                        <h3 class="font-teko text-2xl text-primary mb-4">
                            India Oasis
                        </h3>
                        <p class="text-sm text-gray-600">
                            Sua jornada para o bem-estar começa aqui.
                            Especiarias autênticas, chás e produtos indianos
                            para uma vida equilibrada.
                        </p>
                    </div>
                    <div>
                        <h3 class="font-teko text-xl text-secondary mb-4">
                            Navegação
                        </h3>
                        <ul class="space-y-2 text-sm">
                            <li>
                                <a
                                    href="{% url 'store:about' %}"
                                    class="hover:text-primary"
                                    >Sobre Nós</a
                                >
                            </li>
                            <li>
                                <a
                                    href="{% url 'store:contact' %}"
                                    class="hover:text-primary"
                                    >Contato</a
                                >
                            </li>
                            <li>
                                <a
                                    href="{% url 'store:product_list' %}"
                                    class="hover:text-primary"
                                    >Todos os Produtos</a
                                >
                            </li>
                        </ul>
                    </div>
                    <div>
                        <h3 class="font-teko text-xl text-secondary mb-4">
                            Informações
                        </h3>
                        <ul class="space-y-2 text-sm">
                            <li>
                                <a
                                    href="{% url 'store:terms' %}"
                                    class="hover:text-primary"
                                    >Termos de Uso</a
                                >
                            </li>
                            <li>
                                <a
                                    href="{% url 'store:privacy' %}"
                                    class="hover:text-primary"
                                    >Política de Privacidade</a
                                >
                            </li>
                        </ul>
                    </div>
                    <div>
                        <h3 class="font-teko text-xl text-secondary mb-4">
                            Siga-nos
                        </h3>
                        <div class="flex space-x-4 text-lg">
                            <a href="#" class="text-gray-500 hover:text-primary"
                                ><i class="fab fa-facebook-f"></i
                            ></a>
                            <a href="#" class="text-gray-500 hover:text-primary"
                                ><i class="fab fa-instagram"></i
                            ></a>
                            <a href="#" class="text-gray-500 hover:text-primary"
                                ><i class="fab fa-whatsapp"></i
                            ></a>
                        </div>
                    </div>
                </div>
                <div
                    class="mt-8 pt-8 border-t border-gray-100 text-center text-sm text-gray-500"
                >
                    <p>
                        &copy; {% now "Y" %} India Oasis. Todos os direitos
                        reservados.
                    </p>
                </div>
            </div>
        </footer>

        <script>
            // Lógica para o menu lateral
            document.addEventListener("DOMContentLoaded", function () {
                const openMenuBtn = document.getElementById("open-menu-btn");
                const closeMenuBtn = document.getElementById("close-menu-btn");
                const sideMenu = document.getElementById("side-menu");
                const menuOverlay = document.getElementById("menu-overlay");

                const openMenu = () => {
                    sideMenu.classList.remove("-translate-x-full");
                    menuOverlay.classList.remove("hidden");
                };

                const closeMenu = () => {
                    sideMenu.classList.add("-translate-x-full");
                    menuOverlay.classList.add("hidden");
                };

                if (openMenuBtn)
                    openMenuBtn.addEventListener("click", openMenu);
                if (closeMenuBtn)
                    closeMenuBtn.addEventListener("click", closeMenu);
                if (menuOverlay)
                    menuOverlay.addEventListener("click", closeMenu);

                document.addEventListener("keydown", (e) => {
                    if (
                        e.key === "Escape" &&
                        !sideMenu.classList.contains("-translate-x-full")
                    ) {
                        closeMenu();
                    }
                });
            });

            // Função para buscar o CSRF token dos cookies
            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== "") {
                    const cookies = document.cookie.split(";");
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        if (
                            cookie.substring(0, name.length + 1) ===
                            name + "="
                        ) {
                            cookieValue = decodeURIComponent(
                                cookie.substring(name.length + 1),
                            );
                            break;
                        }
                    }
                }
                return cookieValue;
            }
            const csrftoken = getCookie("csrftoken");

            // Função para exibir notificações "toast"
            function showToast(message, type = "success") {
                const container = document.getElementById("toast-container");
                const toast = document.createElement("div");
                const iconClass =
                    type === "success"
                        ? "fa-check-circle"
                        : "fa-exclamation-circle";

                toast.className = `toast ${type}`;
                toast.innerHTML = `<i class="fas ${iconClass} toast-icon"></i><span>${message}</span>`;

                container.appendChild(toast);

                // Forçar o navegador a renderizar o elemento antes de adicionar a classe 'show'
                setTimeout(() => {
                    toast.classList.add("show");
                }, 10);

                // Remover o toast após 4 segundos
                setTimeout(() => {
                    toast.classList.remove("show");
                    toast.addEventListener("transitionend", () =>
                        toast.remove(),
                    );
                }, 4000);
            }

            // Lógica para adicionar item ao carrinho via AJAX
            document.addEventListener("DOMContentLoaded", () => {
                document
                    .querySelectorAll(".add-to-cart-btn")
                    .forEach((button) => {
                        button.addEventListener("click", function (event) {
                            event.preventDefault();
                            const productId = this.dataset.id;
                            const url = `/cart/add/${productId}/`;

                            fetch(url, {
                                method: "POST",
                                headers: {
                                    "X-CSRFToken": csrftoken,
                                    "X-Requested-With": "XMLHttpRequest", // Identifica a requisição como AJAX para o Django
                                    "Content-Type": "application/json",
                                },
                            })
                                .then((response) => response.json())
                                .then((data) => {
                                    if (data.success) {
                                        // Atualiza os contadores
                                        const cartCountElements =
                                            document.querySelectorAll(
                                                "#cart-count, #cart-mini-count",
                                            );
                                        cartCountElements.forEach((el) => {
                                            el.textContent = data.cart_count;
                                            if (data.cart_count > 0) {
                                                el.classList.remove("hidden");
                                            }
                                        });
                                        showToast(data.message, "success");
                                    } else {
                                        showToast(data.message, "error");
                                    }
                                })
                                .catch((error) => {
                                    console.error("Error:", error);
                                    showToast(
                                        "Ocorreu um erro. Por favor, tente novamente.",
                                        "error",
                                    );
                                });
                        });
                    });
            });
        </script>
        {% block custom_js %}{% endblock custom_js %}
    </body>
</html>
