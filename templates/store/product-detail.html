{% extends 'base.html' %} {% load static %} {% block content %}

<title>
    {% block title %} {{ product.name }} - India Oasis - Temperos e Sabores da
    Índia {% endblock %}
</title>

<!-- ==== CONTEÚDO PRINCIPAL ==== -->
<main class="container mx-auto p-4 sm:p-6 lg:p-8">
    <!-- Breadcrumb -->
    <nav class="mb-6">
        <ol class="flex space-x-2 text-sm">
            <li>
                <a href="index.html" class="text-primary hover:underline"
                    >Início</a
                >
            </li>
            <li class="text-gray-500">/</li>
            <li>
                <a href="products.html" class="text-primary hover:underline"
                    >Produtos</a
                >
            </li>
            <li class="text-gray-500">/</li>
            <li id="product-breadcrumb" class="text-gray-700">
                {{ product.name }}
            </li>
        </ol>
    </nav>

    <!-- Detalhes do Produto -->
    <div
        id="product-detail-container"
        class="bg-white rounded-lg shadow-lg p-6 lg:p-8"
    >
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Imagem do Produto -->
            <div class="space-y-4">
                <div
                    class="aspect-square bg-gray-100 rounded-lg overflow-hidden relative"
                >
                    <img
                        id="product-image"
                        src="{% if product.image %}{{ product.image.url }}{% else %}{% static 'images/default_product.png' %}{% endif %}"
                        alt="{{ product.name }}"
                        class="w-full h-full object-cover"
                    />
                    <button
                        class="absolute top-4 right-4 w-12 h-12 bg-white rounded-full flex items-center justify-center shadow-lg hover:bg-red-50 transition-colors"
                    >
                        <i
                            class="fas fa-heart text-gray-400 hover:text-red-500 text-lg"
                        ></i>
                    </button>
                    <span
                        class="absolute top-4 left-4 bg-green-500 text-white text-sm px-3 py-1 rounded-full"
                    >
                        <i class="fas fa-check mr-1"></i>
                        Em Estoque
                    </span>
                </div>
            </div>

            <!-- Informações do Produto -->
            <div class="space-y-6">
                <div>
                    <span
                        class="inline-block bg-accent text-black text-sm px-3 py-1 rounded-full mb-3 font-bold"
                    >
                        <i class="fas fa-fire mr-1"></i>
                        MAIS VENDIDO
                    </span>
                    <h1
                        id="product-name"
                        class="text-4xl font-teko text-secondary mb-2"
                    >
                        {{ product.name }}
                    </h1>
                    <div class="flex items-center space-x-4 mb-4">
                        <div
                            id="product-rating"
                            class="rating flex items-center"
                        >
                            <i class="fas fa-star text-accent"></i>
                            <i class="fas fa-star text-accent"></i>
                            <i class="fas fa-star text-accent"></i>
                            <i class="fas fa-star text-accent"></i>
                            <i class="fas fa-star text-accent"></i>
                            <span class="ml-2 text-sm font-bold text-gray-700"
                                >4.9</span
                            >
                        </div>
                        <span
                            id="product-reviews-count"
                            class="text-sm text-gray-600"
                        >
                            (127 avaliações)
                        </span>
                        <span class="text-sm text-green-600 font-bold">
                            <i class="fas fa-check-circle mr-1"></i>
                            Verificado
                        </span>
                    </div>
                    <div class="flex items-center space-x-4 mb-4">
                        <p
                            id="product-price"
                            class="text-3xl font-bold text-primary"
                        >
                            R$ {{ product.price|floatformat:2 }}
                        </p>

                        <!-- Botão Adicionar ao Carrinho -->
                        <form
                            action="{% url 'store:cart_add' product.id %}"
                            method="post"
                            class="mt-6"
                        >
                            {% csrf_token %}
                            <button
                                type="submit"
                                class="bg-primary text-white py-3 px-6 rounded-lg text-lg font-semibold hover:bg-primary-dark transition duration-300 w-full lg:w-auto"
                            >
                                Adicionar ao Carrinho
                            </button>
                        </form>
                    </div>
                    <div
                        class="flex items-center space-x-2 text-sm text-gray-600"
                    >
                        <i class="fas fa-shipping-fast text-primary"></i>
                        <span>Frete grátis para pedidos acima de R$ 150</span>
                    </div>
                </div>

                <div>
                    <h2 class="text-2xl font-teko text-secondary mb-3">
                        <i class="fas fa-info-circle text-primary mr-2"></i>
                        Descrição
                    </h2>
                    <p
                        id="product-description"
                        class="text-gray-700 leading-relaxed"
                    >
                        {{ product.description|safe }}
                    </p>
                </div>

                <div>
                    <h2 class="text-2xl font-teko text-secondary mb-3">
                        <i class="fas fa-list-ul text-primary mr-2"></i>
                        Especificações
                    </h2>
                </div>

                <!-- Opções de Compra -->
                <div class="space-y-4">
                    <div class="flex items-center space-x-4">
                        <label for="quantity" class="font-semibold"
                            >Quantidade:</label
                        >
                        <div class="flex items-center border rounded-lg">
                            <button
                                id="decrease-qty"
                                class="px-3 py-2 hover:bg-gray-100"
                                type="button"
                            >
                                <i class="fas fa-minus"></i>
                            </button>
                            <input
                                type="number"
                                id="quantity"
                                value="1"
                                min="1"
                                max="10"
                                class="w-16 text-center border-0 focus:outline-none"
                            />
                            <button
                                id="increase-qty"
                                class="px-3 py-2 hover:bg-gray-100"
                                type="button"
                            >
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>

                    <div class="flex flex-col sm:flex-row gap-4">
                        <button
                            id="add-to-cart-btn"
                            class="btn btn-primary flex-1 text-lg"
                            data-product-id="{{ product.id }}"
                        >
                            <i class="fas fa-shopping-cart mr-2"></i>
                            Adicionar ao Carrinho
                        </button>
                        <button
                            id="add-to-wishlist-btn"
                            class="btn btn-secondary flex-1 text-lg"
                            data-product-id="{{ product.id }}"
                        >
                            <i class="fas fa-heart mr-2"></i>
                            Adicionar aos Desejos
                        </button>
                    </div>
                </div>

                <!-- Informações Adicionais -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h3 class="font-teko text-xl text-secondary mb-2">
                        Informações de Entrega
                    </h3>
                    <ul class="space-y-1 text-sm text-gray-600">
                        <li>
                            <i
                                class="fas fa-shipping-fast mr-2 text-primary"
                            ></i
                            >Frete grátis para pedidos acima de R$ 150
                        </li>
                        <li>
                            <i class="fas fa-clock mr-2 text-primary"></i
                            >Entrega em 5-7 dias úteis
                        </li>
                        <li>
                            <i class="fas fa-shield-alt mr-2 text-primary"></i
                            >Garantia de qualidade
                        </li>
                        <li>
                            <i class="fas fa-undo mr-2 text-primary"></i
                            >Devolução em até 30 dias
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Avaliações -->
    <div class="mt-12 bg-white rounded-lg shadow-lg p-6 lg:p-8">
        <h2 class="text-3xl font-teko text-secondary mb-6">
            Avaliações dos Clientes
        </h2>

        <!-- Resumo das Avaliações -->
        <div class="mb-8 p-4 bg-gray-50 rounded-lg">
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center space-x-4">
                    <span class="text-4xl font-bold text-primary">4.8</span>
                    <div>
                        <div class="rating flex items-center mb-1">
                            <i class="fas fa-star text-accent"></i>
                            <i class="fas fa-star text-accent"></i>
                            <i class="fas fa-star text-accent"></i>
                            <i class="fas fa-star text-accent"></i>
                            <i class="fas fa-star text-accent"></i>
                        </div>
                        <p class="text-sm text-gray-600">
                            Baseado em 127 avaliações
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Lista de Avaliações -->
        <div id="product-reviews" class="space-y-6">
            <!-- Avaliação 1 -->
            <div class="border-b border-gray-200 pb-6">
                <div class="flex items-start space-x-4">
                    <div
                        class="w-12 h-12 bg-primary text-white rounded-full flex items-center justify-center font-bold"
                    >
                        M
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center justify-between mb-2">
                            <div>
                                <h4 class="font-semibold text-gray-800">
                                    Maria Silva
                                </h4>
                                <div class="flex items-center space-x-2">
                                    <div class="rating flex items-center">
                                        <i class="fas fa-star text-accent"></i>
                                        <i class="fas fa-star text-accent"></i>
                                        <i class="fas fa-star text-accent"></i>
                                        <i class="fas fa-star text-accent"></i>
                                        <i class="fas fa-star text-accent"></i>
                                    </div>
                                    <span class="text-sm text-gray-500"
                                        >há 2 dias</span
                                    >
                                </div>
                            </div>
                            <span
                                class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded"
                            >
                                <i class="fas fa-check mr-1"></i>
                                Compra Verificada
                            </span>
                        </div>
                        <p class="text-gray-700">
                            "Produto excepcional! O aroma é incrível e o sabor é
                            autêntico. Uso em todos os meus pratos indianos e o
                            resultado é sempre perfeito. Chegou muito bem
                            embalado e dentro do prazo. Recomendo!"
                        </p>
                        <div
                            class="mt-3 flex items-center space-x-4 text-sm text-gray-500"
                        >
                            <button class="hover:text-primary">
                                <i class="fas fa-thumbs-up mr-1"></i>
                                Útil (12)
                            </button>
                            <button class="hover:text-primary">
                                <i class="fas fa-reply mr-1"></i>
                                Responder
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Avaliação 2 -->
            <div class="border-b border-gray-200 pb-6">
                <div class="flex items-start space-x-4">
                    <div
                        class="w-12 h-12 bg-secondary text-white rounded-full flex items-center justify-center font-bold"
                    >
                        R
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center justify-between mb-2">
                            <div>
                                <h4 class="font-semibold text-gray-800">
                                    Roberto Santos
                                </h4>
                                <div class="flex items-center space-x-2">
                                    <div class="rating flex items-center">
                                        <i class="fas fa-star text-accent"></i>
                                        <i class="fas fa-star text-accent"></i>
                                        <i class="fas fa-star text-accent"></i>
                                        <i class="fas fa-star text-accent"></i>
                                        <i class="far fa-star text-accent"></i>
                                    </div>
                                    <span class="text-sm text-gray-500"
                                        >há 1 semana</span
                                    >
                                </div>
                            </div>
                            <span
                                class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded"
                            >
                                <i class="fas fa-check mr-1"></i>
                                Compra Verificada
                            </span>
                        </div>
                        <p class="text-gray-700">
                            "Muito bom! Comprei para fazer curry e ficou
                            delicioso. A qualidade é excelente e o preço justo.
                            Único ponto negativo foi a demora na entrega, mas
                            valeu a pena esperar."
                        </p>
                        <div
                            class="mt-3 flex items-center space-x-4 text-sm text-gray-500"
                        >
                            <button class="hover:text-primary">
                                <i class="fas fa-thumbs-up mr-1"></i>
                                Útil (8)
                            </button>
                            <button class="hover:text-primary">
                                <i class="fas fa-reply mr-1"></i>
                                Responder
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Avaliação 3 -->
            <div class="border-b border-gray-200 pb-6">
                <div class="flex items-start space-x-4">
                    <div
                        class="w-12 h-12 bg-accent text-black rounded-full flex items-center justify-center font-bold"
                    >
                        A
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center justify-between mb-2">
                            <div>
                                <h4 class="font-semibold text-gray-800">
                                    Ana Costa
                                </h4>
                                <div class="flex items-center space-x-2">
                                    <div class="rating flex items-center">
                                        <i class="fas fa-star text-accent"></i>
                                        <i class="fas fa-star text-accent"></i>
                                        <i class="fas fa-star text-accent"></i>
                                        <i class="fas fa-star text-accent"></i>
                                        <i class="fas fa-star text-accent"></i>
                                    </div>
                                    <span class="text-sm text-gray-500"
                                        >há 2 semanas</span
                                    >
                                </div>
                            </div>
                            <span
                                class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded"
                            >
                                <i class="fas fa-check mr-1"></i>
                                Compra Verificada
                            </span>
                        </div>
                        <p class="text-gray-700">
                            "Primeira vez comprando temperos indianos e escolhi
                            muito bem! O garam masala tem um sabor complexo e
                            rico. Fiz um frango tikka masala que ficou igual ao
                            do restaurante. Já comprei novamente!"
                        </p>
                        <div
                            class="mt-3 flex items-center space-x-4 text-sm text-gray-500"
                        >
                            <button class="hover:text-primary">
                                <i class="fas fa-thumbs-up mr-1"></i>
                                Útil (15)
                            </button>
                            <button class="hover:text-primary">
                                <i class="fas fa-reply mr-1"></i>
                                Responder
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Botão para ver mais avaliações -->
            <div class="text-center pt-4">
                <button class="btn btn-secondary">
                    <i class="fas fa-plus mr-2"></i>
                    Ver Mais Avaliações (124)
                </button>
            </div>
        </div>

        <!-- Formulário de Avaliação -->
        <div class="mt-8 p-6 bg-gray-50 rounded-lg">
            <h3 class="text-2xl font-teko text-secondary mb-4">
                Deixe sua Avaliação
            </h3>
            <form id="review-form">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label
                            for="reviewer-name"
                            class="block mb-1 font-semibold"
                            >Seu Nome</label
                        >
                        <input
                            type="text"
                            id="reviewer-name"
                            class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-primary"
                            required
                        />
                    </div>
                    <div>
                        <label
                            for="reviewer-rating"
                            class="block mb-1 font-semibold"
                            >Avaliação</label
                        >
                        <select
                            id="reviewer-rating"
                            class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-primary"
                            required
                        >
                            <option value="">Selecione uma nota</option>
                            <option value="5">⭐⭐⭐⭐⭐ Excelente</option>
                            <option value="4">⭐⭐⭐⭐ Muito Bom</option>
                            <option value="3">⭐⭐⭐ Bom</option>
                            <option value="2">⭐⭐ Regular</option>
                            <option value="1">⭐ Ruim</option>
                        </select>
                    </div>
                </div>
                <div class="mb-4">
                    <label for="review-comment" class="block mb-1 font-semibold"
                        >Comentário</label
                    >
                    <textarea
                        id="review-comment"
                        rows="4"
                        class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-primary"
                        placeholder="Conte-nos sobre sua experiência com este produto..."
                        required
                    ></textarea>
                </div>
                <button type="submit" class="btn btn-primary">
                    Enviar Avaliação
                </button>
            </form>
        </div>
    </div>

    <!-- Produtos Relacionados -->
    <div class="mt-12">
        <h2 class="text-3xl font-teko text-secondary mb-6">
            Produtos Relacionados
        </h2>
        <div
            id="related-products"
            class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"
        >
            {% for p in related_products %}
            <div
                class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow"
            >
                <div class="aspect-square bg-gray-100 relative">
                    <img
                        src="{% if p.image %}{{ p.image.url }}{% else %}{% static 'images/default_product.png' %}{% endif %}"
                        alt="{{ p.name }}"
                        class="w-full h-full object-cover"
                    />
                    <button
                        class="absolute top-3 right-3 w-8 h-8 bg-white rounded-full flex items-center justify-center shadow-md hover:bg-red-50"
                    >
                        <i
                            class="fas fa-heart text-gray-400 hover:text-red-500"
                        ></i>
                    </button>
                    {% comment %} You can add logic for tags like \'BEST\n
                    SELLER\', \'OFFER\', \'NEW\' here, based on product data
                    {%endcomment %} {% if p.stock == 0 %}
                    <span
                        class="absolute top-3 left-3 bg-red-600 text-white text-xs px-2 py-1 rounded font-bold"
                        >ESGOTADO</span
                    >
                    {% elif p.is_new %} {# Assuming you have an \'is_new\'
                    attribute or logic for this #}
                    <span
                        class="absolute top-3 left-3 bg-green-500 text-white text-xs px-2 py-1 rounded"
                        >NOVO</span
                    >
                    {% endif %}
                </div>
                <div class="p-4">
                    <a
                        href="{% url 'store:product_detail' p.slug %}"
                        class="block"
                    >
                        <h3
                            class="font-semibold text-gray-800 mb-2 hover:text-primary transition-colors"
                        >
                            {{ p.name }}
                        </h3>
                    </a>
                    <p class="text-sm text-gray-600 mb-3">
                        {{ p.description|truncatechars:50 }}
                    </p>
                    <div class="flex items-center mb-2">
                        <div class="flex text-yellow-400 text-sm">
                            {# Logic for rating (stars) can be more complex,
                            adapting to your model #}
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="far fa-star"></i>
                        </div>
                        <span class="text-xs text-gray-500 ml-1">(0)</span>
                        {# Adjust to show actual review count #}
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-lg font-bold text-primary"
                            >R$ {{ p.price|floatformat:2 }}</span
                        >
                        <button
                            class="btn btn-primary text-sm px-4 py-2 add-to-cart-btn"
                            data-product-id="{{ p.id }}"
                        >
                            <i class="fas fa-cart-plus mr-1"></i>
                            Adicionar
                        </button>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-span-full text-center py-12">
                <i class="fas fa-box-open text-6xl text-gray-300 mb-4"></i>
                <h3 class="text-2xl font-teko text-gray-500 mb-2">
                    Nenhum produto relacionado encontrado.
                </h3>
                <p class="text-gray-400">
                    Explore outros produtos em nosso catálogo!
                </p>
            </div>
            {% endfor %}
        </div>
    </div>
</main>

<script>
    // Controles de quantidade
    document
        .getElementById("decrease-qty")
        .addEventListener("click", function () {
            const input = document.getElementById("quantity");
            const currentValue = parseInt(input.value);
            if (currentValue > 1) {
                input.value = currentValue - 1;
            }
        });

    document
        .getElementById("increase-qty")
        .addEventListener("click", function () {
            const input = document.getElementById("quantity");
            const currentValue = parseInt(input.value);
            // Assuming a max quantity of 10 for demonstration, adjust as needed
            if (currentValue < 10) {
                input.value = currentValue + 1;
            }
        });

    // Formulário de avaliação
    document
        .getElementById("review-form")
        .addEventListener("submit", function (e) {
            e.preventDefault();
            alert("Avaliação enviada com sucesso! Obrigado pelo seu feedback.");
            this.reset();
        });

    // Botões de adicionar ao carrinho e wishlist
    document
        .getElementById("add-to-cart-btn")
        .addEventListener("click", function () {
            const quantity = document.getElementById("quantity").value;
            const productId = this.dataset.productId;
            alert(
                `${quantity} unidade(s) de {{ product.name }} adicionada(s) ao carrinho!`,
            );
            // Em uma aplicação real, você enviaria uma requisição AJAX aqui
            // para adicionar o item ao carrinho no backend.
            // Exemplo: fetch(`/cart/add/${productId}/`, { method: 'POST', body: JSON.stringify({ quantity }) });
        });

    document
        .getElementById("add-to-wishlist-btn")
        .addEventListener("click", function () {
            const productId = this.dataset.productId;
            alert("{{ product.name }} adicionado à sua lista de desejos!");
            // Em uma aplicação real, você enviaria uma requisição AJAX aqui
            // para adicionar o item à lista de desejos no backend.
        });
</script>
{% endblock content %}
